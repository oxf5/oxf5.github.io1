<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="专注于web和内网攻防研究,安全开发,安全运维,架构安全,热衷于高质量实用干货分享,提供全方位网络安全培训,更多请扫码关注自己博客下方的微信公众号,同时也期待更多志同道合的兄弟能一起并肩作战">
    

    <!--Author-->
    
        <meta name="author" content="klion">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="入侵检测学习 Snort [一]"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="专注于web和内网攻防研究,安全开发,安全运维,架构安全,热衷于高质量实用干货分享,提供全方位网络安全培训,更多请扫码关注自己博客下方的微信公众号,同时也期待更多志同道合的兄弟能一起并肩作战" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="klion&#39;s blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>入侵检测学习 Snort [一] - klion&#39;s blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    about me
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    blogs
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa " aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2017/09/22/snortpentest/">
                入侵检测学习 Snort [一]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-09-22</span>
            
            
            
                <span class="category">
                    <a href="/categories/snort/">snort</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p><br><br>0x01 关于Snort<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">业界相对比较出名年头也比较久的一款基于网络的开源入侵检测工具</div><div class="line">不过,比较适合中小型网络 <span class="selector-attr">[在流量不是非常大的情况下还是很不错的选择]</span>,规则配置灵活,实战适用性相对较好</div><div class="line">只是,实在不知道为什么要弄一头猪做<span class="selector-tag">logo</span>,这文化差异大的有点儿着实让人无法理解 <span class="selector-pseudo">:)</span></div></pre></td></tr></table></figure></p>
<p>0x02 理解snort的最基本的工作流程<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">内网中的数据 -&gt; 数据嗅探[让内网中其它机器上的数据流过自己] -&gt; 进行各种预处理[防止数据逃逸] -&gt; 规则检测引擎 -&gt; 处理报警/日志 </div><div class="line">											    |		  |</div><div class="line">										      匹配规则库	  存到数据库或者写到日志文件中</div></pre></td></tr></table></figure></p>
<p>0x03 模块具体作用简介<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">数据包嗅探,让其它机器上的指定数据包都经过自己,以便snort分析数据,同样,用的也是libpcap库,包括在其它很多linux平台嗅探工具你都能看到它的身影</div><div class="line">预处理,包重组预处理器,主要是为了防止攻击包被拆分逃避Snort的检测,另一个是协议编码预处理器,主要负责把数据包协议解码成一个统一的格式,再丢给检测模块,最后一个是协议异常检测预处器</div><div class="line">规则匹配检测,也就是当预处理把数据包丢过来以后,规则引擎会将这些数据包逐个和规则库进行匹配,一旦发现数据包内容与某条规则匹配,就丢给报警模块去处理</div><div class="line">报警/日志模块,规则引擎将数据丢给报警模块以后,报警模块会根据snort事先定义好的规则动作(alert,<span class="keyword">log</span><span class="params">...</span>)对其进行不同的处理(写到数据库或日志文件中)</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>0x04 Snrot 大致目录结构<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">/etc/snort/</div><div class="line">├── attribute_table<span class="selector-class">.dtd</span></div><div class="line">├── barnyard2<span class="selector-class">.conf</span>		将报警事先插到数据库中,里面主要定义了一些日志文件位置和数据库连接信息</div><div class="line">├── classification<span class="selector-class">.config</span></div><div class="line">├── etc</div><div class="line">├── file_magic<span class="selector-class">.conf</span></div><div class="line">├── gen-msg<span class="selector-class">.map</span></div><div class="line">├── Makefile</div><div class="line">├── Makefile<span class="selector-class">.am</span></div><div class="line">├── Makefile<span class="selector-class">.in</span></div><div class="line">├── preproc_rules</div><div class="line">├── reference<span class="selector-class">.config</span></div><div class="line">├── rules		snort规则库目录</div><div class="line">├── snort<span class="selector-class">.conf</span>		snort的主配置文件,关于snort工具本身的配置全在这里</div><div class="line">├── so_rules</div><div class="line">├── threshold<span class="selector-class">.conf</span></div><div class="line">└── unicode.map</div></pre></td></tr></table></figure></p>
<p>0x05 环境准备,主要是所需的各类源码包及必要的依赖包<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">centos6</span><span class="selector-class">.9</span> <span class="selector-tag">x_64</span></div><div class="line"><span class="selector-tag">adodb519</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line"><span class="selector-tag">barnyard2-1</span><span class="selector-class">.9</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line"><span class="selector-tag">base-1</span><span class="selector-class">.4</span><span class="selector-class">.5</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line"><span class="selector-tag">daq-2</span><span class="selector-class">.0</span><span class="selector-class">.4</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line"><span class="selector-tag">idsctl</span><span class="selector-class">.zip</span></div><div class="line"><span class="selector-tag">libdnet-1</span><span class="selector-class">.12</span><span class="selector-class">.tgz</span></div><div class="line"><span class="selector-tag">libpcap-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line"><span class="selector-tag">snort-2</span><span class="selector-class">.9</span><span class="selector-class">.7</span><span class="selector-class">.0</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line"><span class="selector-tag">snortrules-snapshot-2970</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div></pre></td></tr></table></figure></p>
<p>0x06 将要检测的内网卡[检测指定内网段]设为静态ip<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/sysconfig/network-scripts/ifcfg-eth0</span></div><div class="line"></div><div class="line"><span class="attr">DEVICE</span>=eth3</div><div class="line"><span class="attr">HWADDR</span>=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">9</span>b:<span class="number">51</span>:ef</div><div class="line"><span class="attr">TYPE</span>=Ethernet</div><div class="line"><span class="attr">UUID</span>=effae4e2-c6e6-<span class="number">4</span>bf8-b9bd-f16ebc38b733</div><div class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></div><div class="line"><span class="attr">NM_CONTROLLED</span>=<span class="literal">yes</span></div><div class="line"><span class="attr">BOOTPROTO</span>=none</div><div class="line"><span class="attr">USERCTL</span>=<span class="literal">no</span></div><div class="line"><span class="attr">PEERDNS</span>=<span class="literal">yes</span></div><div class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></div><div class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">1.177</span></div><div class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></div><div class="line"><span class="attr">DNS2</span>=<span class="number">8.8</span>.<span class="number">8.8</span></div><div class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">1.1</span></div><div class="line"><span class="attr">DNS1</span>=<span class="number">114.114</span>.<span class="number">114.114</span></div></pre></td></tr></table></figure></p>
<p>0x07 先yum一个简易的lamp环境,主要是为了后期在前端展示报警事件方便,所以在这里就直接提前yum一个<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum install -y epel-release</span></div><div class="line"><span class="meta">#</span><span class="bash"> yum install -y gcc gcc-c++ flex bison zlib* libxml2 libpcap* pcre* tcpdump git libtool curl man make wget tree</span></div><div class="line"><span class="meta">#</span><span class="bash"> yum install -y mysql-server mysql-devel php-mysql php-adodb php-pear php-gd libtool php-imap php-ldap php-mbstring php-odbc php-pear php-xml php-pecl-apc httpd php php-mcrypt mcrypt libmcrypt libmcrypt-devel</span></div><div class="line"><span class="meta">#</span><span class="bash"> chkconfig --level 235 mysqld on</span></div><div class="line"><span class="meta">#</span><span class="bash"> chkconfig --level 2345 httpd on</span></div><div class="line"><span class="meta">#</span><span class="bash"> vi /etc/httpd/conf/httpd.conf</span></div><div class="line">  ServerName localhost:80</div><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/mysqld start</span></div><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/httpd start</span></div></pre></td></tr></table></figure></p>
<p>0x08 编译安装Snort<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> tar xf libdnet-1.12.tgz</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> libdnet-1.12</span></div><div class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></div></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> tar xf libpcap-1.0.0.tar.gz</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> libpcap-1.0.0</span></div><div class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> tar xf daq-2.0.4.tar.gz</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> daq-2.0.4</span></div><div class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> tar xf snort-2.9.7.0.tar.gz</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> snort-2.9.7.0</span></div><div class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<p>0x09 配置snort,尽量让snort以一个普通用户权限起来<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> mkdir /etc/snort</span></div><div class="line"><span class="meta">#</span><span class="bash"> cp /root/snort-2.9.7.0/etc/* /etc/snort/</span></div><div class="line"><span class="meta">#</span><span class="bash"> ls /etc/snort/ &amp;&amp; <span class="built_in">cd</span> /etc/snort/</span></div><div class="line"><span class="meta">#</span><span class="bash"> tar xf /root/snortrules-snapshot-2970.tar.gz</span></div><div class="line"><span class="meta">#</span><span class="bash"> touch /etc/snort/rules/white_list.rules /etc/snort/rules/black_list.rules</span></div><div class="line"><span class="meta">#</span><span class="bash"> groupadd -g 5600 snort</span></div><div class="line"><span class="meta">#</span><span class="bash"> useradd snort -u 5600 -d /var/<span class="built_in">log</span>/snort -s /sbin/nologin -c SNORT_IDS -g snort</span></div><div class="line"><span class="meta">#</span><span class="bash"> chown -R snort.snort /etc/snort/</span></div><div class="line"><span class="meta">#</span><span class="bash"> chown -R snort.snort /var/<span class="built_in">log</span>/snort/</span></div><div class="line"><span class="meta">#</span><span class="bash"> vi /etc/snort/snort.conf</span></div><div class="line">  var RULE_PATH /etc/snort/rules</div><div class="line">  var SO_RULE_PATH /etc/snort/so_rules</div><div class="line">  var PREPROC_RULE_PATH /etc/snort/preproc_rules</div><div class="line">  var WHITE_LIST_PATH /etc/snort/rules</div><div class="line">  var BLACK_LIST_PATH /etc/snort/rules</div><div class="line">  config logdir:/var/log/snort</div><div class="line">  output unified2: filename snort.log, limit 128</div><div class="line"><span class="meta">#</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/bin/snort /usr/bin/snort</span></div><div class="line"><span class="meta">#</span><span class="bash"> mkdir -p /usr/<span class="built_in">local</span>/lib/snort_dynamicrules</span></div><div class="line"><span class="meta">#</span><span class="bash"> chown -R snort.snort /usr/<span class="built_in">local</span>/lib/snort_dynamicrules/</span></div><div class="line"><span class="meta">#</span><span class="bash"> chmod -R 755 /usr/<span class="built_in">local</span>/lib/snort_dynamicrules/</span></div></pre></td></tr></table></figure></p>
<p>0x10 先随便先添加一条规则,做下简单测试,规则的意思也很明显,对任意机器间来往的icmp进行报警<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># vi <span class="regexp">/etc/</span>snort<span class="regexp">/rules/</span>local.rules</div><div class="line">  alert icmp <span class="keyword">any</span> <span class="keyword">any</span> -&gt; $HOME_NET <span class="keyword">any</span> (msg:<span class="string">"Ping test"</span>;sid:<span class="number">1000003</span>;rev:<span class="number">1</span>;)</div></pre></td></tr></table></figure></p>
<p>0x11 编译安装 barnyard2,顺带把表结构都导进去,等会儿要往里面插各种snort数据<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> tar xf barnyard2-1.9.tar.gz -C /usr/<span class="built_in">local</span>/src/</span></div><div class="line"><span class="meta">#</span><span class="bash"> mysqladmin -u root password <span class="string">"admin"</span></span></div><div class="line"><span class="meta">#</span><span class="bash"> mysql -uroot -p</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database snort;</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> use snort;</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> create user <span class="string">'snort'</span>@<span class="string">'localhost'</span> identified by <span class="string">'admin'</span>;</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant create,select,update,insert,delete on snort.* to snort@localhost identified by <span class="string">'admin'</span>;</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> password <span class="keyword">for</span> snort@localhost=password(<span class="string">'admin'</span>);</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">source</span> /usr/<span class="built_in">local</span>/src/barnyard2-1.9/schemas/create_mysql;</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> show tables;</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd /usr/local/src/barnyard2-1.9/</span></div><div class="line"><span class="comment"># ./configure --with-mysql --with-mysql-libraries=/usr/lib64/mysql/ &amp;&amp; make &amp;&amp; make install</span></div><div class="line"><span class="comment"># mkdir /var/log/barnyard2</span></div><div class="line"><span class="comment"># touch /var/log/snort/barnyard2.waldo</span></div><div class="line"><span class="comment"># chown -R snort.snort /var/log/snort/barnyard2.waldo</span></div><div class="line"><span class="comment"># cp /usr/local/src/barnyard2-1.9/etc/barnyard2.conf /etc/snort/</span></div><div class="line"><span class="comment"># vi /etc/snort/barnyard2.conf </span></div><div class="line"> <span class="built_in"> config </span>logdir: /var/log/barnyard2</div><div class="line"> <span class="built_in"> config </span>hostname:  localhost</div><div class="line"> <span class="built_in"> config </span>interface: eth3</div><div class="line"> <span class="built_in"> config </span>waldo_file: /var/log/snort/barnyard2.waldo</div><div class="line">  output database: log, mysql, <span class="attribute">user</span>=snort <span class="attribute">password</span>=admin <span class="attribute">dbname</span>=snort <span class="attribute">host</span>=localhost</div></pre></td></tr></table></figure>
<p>0x12 启动snort,观察报警事件到底有没有被记录到数据库中<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> unzip idsctl.zip</span></div><div class="line"><span class="meta">#</span><span class="bash"> ./idsctl</span></div><div class="line"><span class="meta">#</span><span class="bash"> ./idsctl start</span></div><div class="line"><span class="meta">#</span><span class="bash"> snort -q -u snort -g snort -c /etc/snort/snort.conf -i eth3 -D</span></div><div class="line"><span class="meta">#</span><span class="bash"> ping 192.168.1.1    随便ping,只是为了让snort捕获icmp</span></div><div class="line"><span class="meta">#</span><span class="bash"> mysql -u snort -p -D snort -e <span class="string">"select count(*) from event"</span></span></div><div class="line"><span class="meta">#</span><span class="bash"> ll /var/<span class="built_in">log</span>/snort/</span></div></pre></td></tr></table></figure></p>
<p>0x13 安装展示前端<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> pear upgrade pear</span></div><div class="line"><span class="meta">#</span><span class="bash"> pear channel-update pear.php.net</span></div><div class="line"><span class="meta">#</span><span class="bash"> pear install Image_Graph-alpha Image_Canvas-alpha Image_Color Numbers_Roman</span></div><div class="line"><span class="meta">#</span><span class="bash"> tar xf adodb519.tar.gz -C /var/www/html/</span></div><div class="line"><span class="meta">#</span><span class="bash"> mv /var/www/html/adodb5/ /var/www/html/adodb</span></div><div class="line"><span class="meta">#</span><span class="bash"> tar xf base-1.4.5.tar.gz -C /var/www/html/</span></div><div class="line"><span class="meta">#</span><span class="bash"> mv /var/www/html/base-1.4.5/ /var/www/html/base</span></div><div class="line"><span class="meta">#</span><span class="bash"> vi /etc/php.ini</span></div><div class="line">  error_reporting = E_ALL &amp; ~E_NOTICE</div><div class="line"><span class="meta">#</span><span class="bash"> chown -R apache.apache /var/www/html/</span></div><div class="line"><span class="meta">#</span><span class="bash"> chmod -R 755 /var/www/html/</span></div><div class="line"><span class="meta">#</span><span class="bash"> pkill snort</span></div><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/mysqld restart</span></div><div class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/httpd restart</span></div></pre></td></tr></table></figure></p>
<p>0x14 访问前端页面进行简单配置,观察报警事件有没有被取出来,最后,实际部署成功的效果图如下<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.177</span><span class="regexp">/base/</span>base_main.php</div></pre></td></tr></table></figure></p>
<p><img src="/img/snort.png" alt="&#39;&#39;"><br></p>
<p>0x15 本次的重点只是先把平台搞起来再说,后期的重点,还是会在下面这些点上,每个点涉及到的具体的东西可能又非常的多,不是简短几句话就能说明白的,长路漫漫,还是一点一点的稳扎稳打吧<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">根据自己的实际需求熟练编写Snort规则</div><div class="line">捕捉内网各种常规端口扫描特征,主要是针对各种常见的端口扫描工具标志,如,nmap,zmap,masscan,supersan...</div><div class="line">捕捉内网各类基础服务爆破特征,主要是针对hydra,medusa...</div><div class="line">捕捉内网web各种高危入侵特征[sql注入,xss劫持,表单爆破...]</div><div class="line">捕捉内网各类常规嗅探行为,如,最典型的arp...</div><div class="line">借助snort识别内网中的各类meterpreter的shell</div><div class="line">感知内网中的各种常规脱裤行为,如,pgsql,oracle,mysql,mssql...</div><div class="line">识别内网中的常规DDOS流量并灵活与iptables进行联动</div><div class="line">捕捉各类常规非加密tcp远控数据特征</div><div class="line">尝试识别捕捉各种常规流量重放攻击</div><div class="line">深入学习理解各类入侵检测对抗手段</div><div class="line">....</div></pre></td></tr></table></figure></p>
<p>0x16 小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;平台部署确实比较简单,基本也不存在什么技术含量,最终,关键还是看我们能不能用工具实际的干活,再牛逼的工具,不能很好的用起来,也只是摆设,这也可能是后期要重点慢慢啃的地方,还是那句话,实战为主,后期我们还会着重介绍另一款入侵检测系统,Suricata,个人觉得这个会更好,至于为什么更好,待续…</p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/snort/">#snort</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">

<center>
<span>有偿提供各类全面靠谱的安全优化加固方案,入侵取证及全方位企业内部及个人网络安全培训...<font color="red"> &nbsp;&nbsp;klion@protonmail.com</span><br>
<br>
<br>
<font size="5" color="#00FF7F" style="margin-left=-10px;">关注公众号</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size="5" color="#00FF7F">随意捐助 [ 微信 ]</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size="5" color="#00FF7F">加入小密圈</font>
<br>
<br>
<img src="/img/small.jpg"  alt="klionsec" />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="/img/klion.png" with="262" height="254" alt="klionsec" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="/img/xiaomi.png" with="260" height="257">
<br><br>
<br><font color="yellow" size="4">
如果觉得内容还不错,也希望您能高抬贵手帮忙转发一下,让更多需要的人都能看到,本人不胜感激
</font><br><br>
<font color="#00FF7F" size="4">
相信您的支持和鼓励换来的将会是更高质量的不懈创作,本人将一直秉承博客初衷,坚持高质量原创实用干货分享</font>
<br><br><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">博客累计访问量 <span id="busuanzi_value_site_pv"></span> </span>
<span id="busuanzi_container_site_uv">
累计访客数 <span id="busuanzi_value_site_uv"></span> 
</span>
<span id="showDays"></span>
<script>
var birthDay = new Date("12/28/2014");
var now = new Date();
var duration = now.getTime() - birthDay.getTime(); 
var total= Math.floor(duration / (1000 * 60 * 60 * 24));
document.getElementById("showDays").innerHTML = " 其实,博客已默默独自坚挺了 "+total+" 天";
</script>
<br>
<br>
多年实战渗透经验积累[大中小型网络] + 娴熟的底层及脚本编写能力 + 熟练的协议分析能力 + 多个大中型安全架构实际设计部署经验 + 良好的逆向分析能力[一定的0day挖掘能力] = 合格安全架构师
<br>
<br>
<br>
<font size=6 color="white">唯一不变的,就是一直在变</font>
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klionsec">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/klionsec">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/klionsec">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="http://www.jianshu.com/u/2a4d8b1f03e0">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.zhihu.com/people/klionsec/activities">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:klion@protonmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    <strong><font size=4 color=#00FF7F> Blog by klionsec </font></strong>
                </div>
            </div>
        </div>
    </div>
<!--
<audio autoplay="autoplay" width="300" height="200">
	<source src="/img/Bandari - Childhood Memory.mp3" type="audio/mpeg" />
</audio>
-->
</footer>



<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>